diff --git a/agent/consul/state/catalog.go b/agent/consul/state/catalog.go
index b24929f101..3317658f0f 100644
--- a/agent/consul/state/catalog.go
+++ b/agent/consul/state/catalog.go
@@ -1251,7 +1251,8 @@ func addIPOffset(b net.IP) (net.IP, error) {
 // Returns the sum modulo 2^128 as a new IPv6 address.
 func addIPv6Offset(a, b net.IP) (net.IP, error) {
 	a4 := a.To4()
-	if a4 != nil {
+	b4 := b.To4()
+	if a4 != nil || b4 != nil {
 		return nil, errors.New("ip is not valid IPv6")
 	}
 	a16 := a.To16()
diff --git a/agent/consul/state/catalog_test.go b/agent/consul/state/catalog_test.go
index bd4956b5df..2d13096b8f 100644
--- a/agent/consul/state/catalog_test.go
+++ b/agent/consul/state/catalog_test.go
@@ -239,8 +239,7 @@ func TestAddIPv6Offset(t *testing.T) {
 			name:      "IPv4 address for b",
 			a:         net.ParseIP("fd00::1"),
 			b:         net.ParseIP("1.2.3.4"),
-			expected:  net.ParseIP("fd00::ffff:102:305"),
-			expectErr: false,
+			expectErr: true,
 		},
 	}
 
diff --git a/command/connect/redirecttraffic/redirect_traffic.go b/command/connect/redirecttraffic/redirect_traffic.go
index d48a3658e1..dbeb015929 100644
--- a/command/connect/redirecttraffic/redirect_traffic.go
+++ b/command/connect/redirecttraffic/redirect_traffic.go
@@ -10,7 +10,6 @@ import (
 	"strconv"
 
 	"github.com/go-viper/mapstructure/v2"
-	"github.com/hashicorp/consul/agent/netutil"
 	"github.com/hashicorp/consul/api"
 	"github.com/hashicorp/consul/command/flags"
 	"github.com/hashicorp/consul/sdk/iptables"
@@ -76,6 +75,7 @@ func (c *cmd) init() {
 		"Additional user ID to exclude from traffic redirection. May be provided multiple times.")
 	c.flags.StringVar(&c.netNS, "netns", "", "The network namespace where traffic redirection rules should apply."+
 		"This must be a path to the network namespace, e.g. /var/run/netns/foo.")
+	c.flags.BoolVar(&c.dualStack, "dual-stack", false, "To setup dual-stack based routing")
 
 	c.http = &flags.HTTPFlags{}
 	flags.Merge(c.flags, c.http.ClientFlags())
@@ -111,18 +111,7 @@ func (c *cmd) Run(args []string) int {
 		return 1
 	}
 
-	ac, err := c.http.APIConfig()
-	if err != nil {
-		c.UI.Error(fmt.Sprintf("error creating Consul API client: %s", err.Error()))
-		return 1
-	}
-	ds, err := netutil.IsDualStack(ac, false)
-	if err != nil {
-		c.UI.Error(fmt.Sprintf("error determining if agent is running in dual-stack mode: %s", err.Error()))
-		return 1
-	}
-
-	err = iptables.Setup(cfg, ds)
+	err = iptables.Setup(cfg, c.dualStack)
 	if err != nil {
 		c.UI.Error(fmt.Sprintf("Error setting up traffic redirection rules: %s", err.Error()))
 		return 1
diff --git a/command/flags/http.go b/command/flags/http.go
index c2e7a4fd44..009c26629c 100644
--- a/command/flags/http.go
+++ b/command/flags/http.go
@@ -159,13 +159,6 @@ func (f *HTTPFlags) APIClient() (*api.Client, error) {
 	return api.NewClient(c)
 }
 
-func (f *HTTPFlags) APIConfig() (*api.Config, error) {
-	c := api.DefaultConfig()
-	f.MergeOntoConfig(c)
-
-	return c, nil
-}
-
 func (f *HTTPFlags) MergeOntoConfig(c *api.Config) {
 	f.address.Merge(&c.Address)
 	f.token.Merge(&c.Token)
