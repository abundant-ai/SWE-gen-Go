diff --git a/cmd/goose/main.go b/cmd/goose/main.go
index 0b6f807..c842171 100644
--- a/cmd/goose/main.go
+++ b/cmd/goose/main.go
@@ -19,7 +19,6 @@ import (
 	"github.com/pressly/goose/v3"
 	"github.com/pressly/goose/v3/internal/cfg"
 	"github.com/pressly/goose/v3/internal/migrationstats"
-	"github.com/pressly/goose/v3/internal/migrationstats/migrationstatsos"
 )
 
 var (
@@ -320,8 +319,10 @@ func printValidate(filename string, verbose bool) error {
 	if err != nil {
 		return err
 	}
-	fileWalker := migrationstatsos.NewFileWalker(filenames...)
-	stats, err := migrationstats.GatherStats(fileWalker, false)
+	stats, err := migrationstats.GatherStats(
+		migrationstats.NewFileWalker(filenames...),
+		false,
+	)
 	if err != nil {
 		return err
 	}
diff --git a/internal/migrationstats/migration_go.go b/internal/migrationstats/migration_go.go
index ad8d57d..3509c27 100644
--- a/internal/migrationstats/migration_go.go
+++ b/internal/migrationstats/migration_go.go
@@ -7,11 +7,14 @@ import (
 	"go/parser"
 	"go/token"
 	"io"
+	"strings"
 )
 
 const (
-	registerGoFuncName     = "AddMigration"
-	registerGoFuncNameNoTx = "AddMigrationNoTx"
+	registerGoFuncName            = "AddMigration"
+	registerGoFuncNameNoTx        = "AddMigrationNoTx"
+	registerGoFuncNameContext     = "AddMigrationContext"
+	registerGoFuncNameNoTxContext = "AddMigrationNoTxContext"
 )
 
 type goMigration struct {
@@ -72,10 +75,10 @@ func parseInitFunc(fd *ast.FuncDecl) (*goMigration, error) {
 		funcName := sel.Sel.Name
 		b := false
 		switch funcName {
-		case registerGoFuncName:
+		case registerGoFuncName, registerGoFuncNameContext:
 			b = true
 			gf.useTx = &b
-		case registerGoFuncNameNoTx:
+		case registerGoFuncNameNoTx, registerGoFuncNameNoTxContext:
 			gf.useTx = &b
 		default:
 			continue
@@ -107,11 +110,15 @@ func parseInitFunc(fd *ast.FuncDecl) (*goMigration, error) {
 	}
 	// validation
 	switch gf.name {
-	case registerGoFuncName, registerGoFuncNameNoTx:
+	case registerGoFuncName, registerGoFuncNameNoTx, registerGoFuncNameContext, registerGoFuncNameNoTxContext:
 	default:
-		return nil, fmt.Errorf("goose register function must be one of: %s or %s",
-			registerGoFuncName,
-			registerGoFuncNameNoTx,
+		return nil, fmt.Errorf("goose register function must be one of: %s",
+			strings.Join([]string{
+				registerGoFuncName,
+				registerGoFuncNameNoTx,
+				registerGoFuncNameContext,
+				registerGoFuncNameNoTxContext,
+			}, ", "),
 		)
 	}
 	if gf.useTx == nil {
diff --git a/internal/migrationstats/migrationstats_walker.go b/internal/migrationstats/migrationstats_walker.go
new file mode 100644
index 0000000..4e224e6
--- /dev/null
+++ b/internal/migrationstats/migrationstats_walker.go
@@ -0,0 +1,44 @@
+package migrationstats
+
+import (
+	"io"
+	"os"
+	"path/filepath"
+)
+
+// NewFileWalker returns a new FileWalker for the given filenames.
+//
+// Filenames without a .sql or .go extension are ignored.
+func NewFileWalker(filenames ...string) FileWalker {
+	return &fileWalker{
+		filenames: filenames,
+	}
+}
+
+type fileWalker struct {
+	filenames []string
+}
+
+var _ FileWalker = (*fileWalker)(nil)
+
+func (f *fileWalker) Walk(fn func(filename string, r io.Reader) error) error {
+	for _, filename := range f.filenames {
+		ext := filepath.Ext(filename)
+		if ext != ".sql" && ext != ".go" {
+			continue
+		}
+		if err := walk(filename, fn); err != nil {
+			return err
+		}
+	}
+	return nil
+}
+
+func walk(filename string, fn func(filename string, r io.Reader) error) error {
+	file, err := os.Open(filename)
+	if err != nil {
+		return err
+	}
+	defer file.Close()
+	return fn(filename, file)
+}
